<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>journal.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MyLabJournal</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="journal.html">Journal</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Class notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="dictionary.html">Dictionary</a>
    </li>
    <li>
      <a href="data_wrangling.html">Data Wrangling</a>
    </li>
    <li>
      <a href="ggplot_graphs.html">ggplot graphs</a>
    </li>
    <li>
      <a href="machine_learning.html">machine learning</a>
    </li>
  </ul>
</li>
<li>
  <a href="links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<hr />
<p>title: “REPORT OF DATA-SCIENCE CLASS” author: “Santiago Pulido Guerrero” date: “23-11-2020” output: html_document: toc: true toc_float: true collapsed: false number_sections: true toc_depth: 3 #code_folding: hide — -g</p>
<div id="chapter-2-intro-to-the-tidyverse" class="section level2">
<h2>CHAPTER 2: INTRO TO THE TIDYVERSE</h2>
<p>#CHALLENGE 1: ANALYSIS OF SALES BY PLACE AND YEAR</p>
<p>Last compiled: 2020-11-30</p>
<ol style="list-style-type: decimal">
<li>Analysis of the sales by location and by year and location considering the 12 states of Germany and using bar plots.</li>
</ol>
<pre class="r"><code># Data Science at TUHH ------------------------------------------------------
# SALES ANALYSIS ----

# 1.0 Load libraries ----
library(ggplot2)
library(tidyverse)
library(readxl)
library(&quot;writexl&quot;)

# 2.0 Importing Files ----

bikes_data &lt;- read_excel(path = &quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/01_raw_data/bikes.xlsx&quot;,sheet = NULL)
bikeshops_data &lt;- read_excel(path = &quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/01_raw_data/bikeshops.xlsx&quot;,sheet = NULL)
orderlines_data &lt;- read_excel(path = &quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/01_raw_data/orderlines.xlsx&quot;,sheet = NULL)

# 3.0 Joining Data ----

bikes_total_dataA = left_join(orderlines_data,bikes_data, by = c(&quot;product.id&quot;=&quot;bike.id&quot;))
bikes_total_dataB = left_join(orderlines_data,bikeshops_data, by = c(&quot;customer.id&quot;=&quot;bikeshop.id&quot;))
bike_orderlines_wrangled = left_join(bikes_total_dataA,bikes_total_dataB,by = NULL)

# 5.0 Wrangling Data ----

bike_orderlines_wrangled_tbl &lt;- bike_orderlines_wrangled %&gt;% separate(col = &#39;location&#39;,into = c(&quot;City&quot;,&quot;State&quot;),sep = &quot;,&quot;)%&gt;% 
mutate(total.price = price*quantity)%&gt;%
select(order.id, contains(&quot;order&quot;),contains(&quot;model&quot;),contains(&quot;location&quot;),price, quantity, total.price,everything()) %&gt;%
rename(bikeshop = name) %&gt;%  set_names(names(.) %&gt;% str_replace_all(&quot;\\.&quot;, &quot;_&quot;))


# 6.0 Business Insights ----

# 6.1 States with the highest revenue ----

# Step 1 - Manipulate

sales_by_loc_tbl &lt;- bike_orderlines_wrangled_tbl %&gt;% separate(col = &quot;order_date&quot;,into = c(&quot;order_year&quot;,&quot;order_month&quot;,&quot;order_day&quot;),sep = &quot;-&quot;) %&gt;% 
  group_by(State) %&gt;%  summarize(total_sales = sum(total_price))%&gt;%
  mutate(sales_in_euros = scales::dollar(total_sales, big.mark = &quot;.&quot;,decimal.mark = &quot;,&quot;,prefix = &quot;&quot;,suffix = &quot;\u20ac&quot;))

sales_by_loc_year_tbl &lt;- bike_orderlines_wrangled_tbl %&gt;% separate(col = &quot;order_date&quot;,into = c(&quot;order_year&quot;,&quot;order_month&quot;,&quot;order_day&quot;),sep = &quot;-&quot;) %&gt;% 
  group_by(order_year,State) %&gt;%  summarize(total_sales = sum(total_price))%&gt;%
  mutate(sales_in_euros = scales::dollar(total_sales, big.mark = &quot;.&quot;,decimal.mark = &quot;,&quot;,prefix = &quot;&quot;,suffix = &quot;\u20ac&quot;))
  
# Step 2 - Visualize

sales_by_loc_tbl %&gt;% ggplot(aes(x = State,y = total_sales))+ theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
geom_col(fill = &quot;#2DC6D6&quot;) + geom_label(aes(label = sales_in_euros)) + geom_smooth(method = &quot;lm&quot;, se = FALSE) +
scale_y_continuous(labels = scales::dollar_format(big.mark = &quot;.&quot;,decimal.mark = &quot;,&quot;,prefix = &quot;&quot;,suffix = &quot;\u20ac&quot;)) +  
labs(
    title    = &quot;Revenue by state&quot;,
    subtitle = &quot;Highest revenues&quot;,
    x = &quot;&quot;, # Override defaults for x and y
    y = &quot;Revenue in euros \u20ac&quot;
  )</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;sales_by_loc_tbl.png&quot;, height = 30, width = 35,units = &quot;cm&quot;)

# 6.2 Sales by Year and Category 2 ----

# Step 2 - Visualize

sales_by_loc_year_tbl %&gt;% ggplot(aes(x = order_year,y = total_sales, fill = State))+ theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  geom_col() + facet_wrap(~ State) + scale_y_continuous(labels = scales::dollar_format(big.mark = &quot;.&quot;,decimal.mark = &quot;,&quot;,prefix = &quot;&quot;,suffix = &quot;\u20ac&quot;)) +  
  labs(
    title    = &quot;Revenue by state&quot;,
    subtitle = &quot;Highest revenues&quot;,
    fill = &quot;Sales by states&quot;
  )</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;sales_by_loc_year_tbl.png&quot;, height = 35, width = 35,units = &quot;cm&quot;)

# 7.0 Writing Files ----

#install.packages(&quot;writexl&quot;)
library(&quot;writexl&quot;)
# 7.1 XLSX ----
sales_by_loc_tbl %&gt;% write_xlsx(&quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/02_wrangled_data/sales_by_loc.xlsx&quot;)
sales_by_loc_year_tbl %&gt;% write_xlsx(&quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/02_wrangled_data/sales_by_loc_year.xlsx&quot;)
# 7.2 CSV ----
sales_by_loc_tbl %&gt;% write_csv(&quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/02_wrangled_data/sales_by_loc.csv&quot;)
sales_by_loc_year_tbl %&gt;% write_csv(&quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/02_wrangled_data/sales_by_loc_year.csv&quot;)
# 7.3 RDS ----
sales_by_loc_tbl %&gt;% write_rds(&quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/02_wrangled_data/sales_by_loc.rds&quot;)
sales_by_loc_year_tbl %&gt;% write_rds(&quot;D:/data-science/DS_Data-Science/00_data/01_bike_sales/02_wrangled_data/sales_by_loc_year.rds&quot;)</code></pre>
</div>
<div id="challenge-2" class="section level1">
<h1>CHALLENGE 2:</h1>
<div id="api-data-acquisition" class="section level2">
<h2>API data acquisition</h2>
<p>For the API data acquisition challenge, the OPENWEATHERMAP provider was selected. The code used was</p>
<pre class="r"><code>## CHALLENGE 2.0
# SECTION 1.0
# 1.0 LIBRARIES ----

library(tidyverse) # Main Package - Loads dplyr, purrr, etc.
library(rvest)     # HTML Hacking &amp; Web Scraping
library(xopen)     # Quickly opening URLs
library(jsonlite)  # converts JSON files to R objects
library(glue)      # concatenate strings
library(stringi)   # character string/text processing
library(glue)      # String interpolation
library(httr)      # API GET function
library(rstudioapi) # Securing credentials

# 1.2 request data from source

city_name &lt;- list(&quot;Hamburg&quot;,&quot;Tokio&quot;,&quot;Bogota&quot;)
Api_key &lt;- &quot;d7736dd80cd838bf45d50b696167e9f5&quot;
city_wheather = list()
x = c()
n = 0;
for (i in city_name){
n = n + 1
resp &lt;- GET(glue(&quot;https://api.openweathermap.org/data/2.5/weather?q={i}&amp;units=metric&amp;appid={Api_key}&quot;));
x[n] &lt;- content(resp, as = &quot;text&quot;)

}</code></pre>
<pre class="r"><code># 1.3 Print data from the Source
map(x,print);</code></pre>
<pre><code>## [1] &quot;{\&quot;coord\&quot;:{\&quot;lon\&quot;:10,\&quot;lat\&quot;:53.55},\&quot;weather\&quot;:[{\&quot;id\&quot;:804,\&quot;main\&quot;:\&quot;Clouds\&quot;,\&quot;description\&quot;:\&quot;overcast clouds\&quot;,\&quot;icon\&quot;:\&quot;04n\&quot;}],\&quot;base\&quot;:\&quot;stations\&quot;,\&quot;main\&quot;:{\&quot;temp\&quot;:3.39,\&quot;feels_like\&quot;:-0.39,\&quot;temp_min\&quot;:2.78,\&quot;temp_max\&quot;:5,\&quot;pressure\&quot;:1017,\&quot;humidity\&quot;:93},\&quot;visibility\&quot;:9000,\&quot;wind\&quot;:{\&quot;speed\&quot;:3.1,\&quot;deg\&quot;:150},\&quot;clouds\&quot;:{\&quot;all\&quot;:100},\&quot;dt\&quot;:1606330698,\&quot;sys\&quot;:{\&quot;type\&quot;:1,\&quot;id\&quot;:1263,\&quot;country\&quot;:\&quot;DE\&quot;,\&quot;sunrise\&quot;:1606287862,\&quot;sunset\&quot;:1606317012},\&quot;timezone\&quot;:3600,\&quot;id\&quot;:2911298,\&quot;name\&quot;:\&quot;Hamburg\&quot;,\&quot;cod\&quot;:200}&quot;
## [1] &quot;{\&quot;coord\&quot;:{\&quot;lon\&quot;:139.69,\&quot;lat\&quot;:35.69},\&quot;weather\&quot;:[{\&quot;id\&quot;:803,\&quot;main\&quot;:\&quot;Clouds\&quot;,\&quot;description\&quot;:\&quot;broken clouds\&quot;,\&quot;icon\&quot;:\&quot;04n\&quot;}],\&quot;base\&quot;:\&quot;stations\&quot;,\&quot;main\&quot;:{\&quot;temp\&quot;:11.09,\&quot;feels_like\&quot;:9.32,\&quot;temp_min\&quot;:9.44,\&quot;temp_max\&quot;:12,\&quot;pressure\&quot;:1019,\&quot;humidity\&quot;:93},\&quot;visibility\&quot;:10000,\&quot;wind\&quot;:{\&quot;speed\&quot;:2.6,\&quot;deg\&quot;:330},\&quot;clouds\&quot;:{\&quot;all\&quot;:75},\&quot;dt\&quot;:1606330770,\&quot;sys\&quot;:{\&quot;type\&quot;:1,\&quot;id\&quot;:8074,\&quot;country\&quot;:\&quot;JP\&quot;,\&quot;sunrise\&quot;:1606339682,\&quot;sunset\&quot;:1606375765},\&quot;timezone\&quot;:32400,\&quot;id\&quot;:1850147,\&quot;name\&quot;:\&quot;Tokyo\&quot;,\&quot;cod\&quot;:200}&quot;
## [1] &quot;{\&quot;coord\&quot;:{\&quot;lon\&quot;:-74.08,\&quot;lat\&quot;:4.61},\&quot;weather\&quot;:[{\&quot;id\&quot;:803,\&quot;main\&quot;:\&quot;Clouds\&quot;,\&quot;description\&quot;:\&quot;broken clouds\&quot;,\&quot;icon\&quot;:\&quot;04d\&quot;}],\&quot;base\&quot;:\&quot;stations\&quot;,\&quot;main\&quot;:{\&quot;temp\&quot;:18.23,\&quot;feels_like\&quot;:18.14,\&quot;temp_min\&quot;:18.23,\&quot;temp_max\&quot;:18.23,\&quot;pressure\&quot;:1009,\&quot;humidity\&quot;:65,\&quot;sea_level\&quot;:1009,\&quot;grnd_level\&quot;:751},\&quot;visibility\&quot;:10000,\&quot;wind\&quot;:{\&quot;speed\&quot;:0.82,\&quot;deg\&quot;:205},\&quot;clouds\&quot;:{\&quot;all\&quot;:75},\&quot;dt\&quot;:1606330770,\&quot;sys\&quot;:{\&quot;country\&quot;:\&quot;CO\&quot;,\&quot;sunrise\&quot;:1606301230,\&quot;sunset\&quot;:1606344012},\&quot;timezone\&quot;:-18000,\&quot;id\&quot;:3688689,\&quot;name\&quot;:\&quot;Bogotá\&quot;,\&quot;cod\&quot;:200}&quot;</code></pre>
<pre><code>## [[1]]
## [1] &quot;{\&quot;coord\&quot;:{\&quot;lon\&quot;:10,\&quot;lat\&quot;:53.55},\&quot;weather\&quot;:[{\&quot;id\&quot;:804,\&quot;main\&quot;:\&quot;Clouds\&quot;,\&quot;description\&quot;:\&quot;overcast clouds\&quot;,\&quot;icon\&quot;:\&quot;04n\&quot;}],\&quot;base\&quot;:\&quot;stations\&quot;,\&quot;main\&quot;:{\&quot;temp\&quot;:3.39,\&quot;feels_like\&quot;:-0.39,\&quot;temp_min\&quot;:2.78,\&quot;temp_max\&quot;:5,\&quot;pressure\&quot;:1017,\&quot;humidity\&quot;:93},\&quot;visibility\&quot;:9000,\&quot;wind\&quot;:{\&quot;speed\&quot;:3.1,\&quot;deg\&quot;:150},\&quot;clouds\&quot;:{\&quot;all\&quot;:100},\&quot;dt\&quot;:1606330698,\&quot;sys\&quot;:{\&quot;type\&quot;:1,\&quot;id\&quot;:1263,\&quot;country\&quot;:\&quot;DE\&quot;,\&quot;sunrise\&quot;:1606287862,\&quot;sunset\&quot;:1606317012},\&quot;timezone\&quot;:3600,\&quot;id\&quot;:2911298,\&quot;name\&quot;:\&quot;Hamburg\&quot;,\&quot;cod\&quot;:200}&quot;
## 
## [[2]]
## [1] &quot;{\&quot;coord\&quot;:{\&quot;lon\&quot;:139.69,\&quot;lat\&quot;:35.69},\&quot;weather\&quot;:[{\&quot;id\&quot;:803,\&quot;main\&quot;:\&quot;Clouds\&quot;,\&quot;description\&quot;:\&quot;broken clouds\&quot;,\&quot;icon\&quot;:\&quot;04n\&quot;}],\&quot;base\&quot;:\&quot;stations\&quot;,\&quot;main\&quot;:{\&quot;temp\&quot;:11.09,\&quot;feels_like\&quot;:9.32,\&quot;temp_min\&quot;:9.44,\&quot;temp_max\&quot;:12,\&quot;pressure\&quot;:1019,\&quot;humidity\&quot;:93},\&quot;visibility\&quot;:10000,\&quot;wind\&quot;:{\&quot;speed\&quot;:2.6,\&quot;deg\&quot;:330},\&quot;clouds\&quot;:{\&quot;all\&quot;:75},\&quot;dt\&quot;:1606330770,\&quot;sys\&quot;:{\&quot;type\&quot;:1,\&quot;id\&quot;:8074,\&quot;country\&quot;:\&quot;JP\&quot;,\&quot;sunrise\&quot;:1606339682,\&quot;sunset\&quot;:1606375765},\&quot;timezone\&quot;:32400,\&quot;id\&quot;:1850147,\&quot;name\&quot;:\&quot;Tokyo\&quot;,\&quot;cod\&quot;:200}&quot;
## 
## [[3]]
## [1] &quot;{\&quot;coord\&quot;:{\&quot;lon\&quot;:-74.08,\&quot;lat\&quot;:4.61},\&quot;weather\&quot;:[{\&quot;id\&quot;:803,\&quot;main\&quot;:\&quot;Clouds\&quot;,\&quot;description\&quot;:\&quot;broken clouds\&quot;,\&quot;icon\&quot;:\&quot;04d\&quot;}],\&quot;base\&quot;:\&quot;stations\&quot;,\&quot;main\&quot;:{\&quot;temp\&quot;:18.23,\&quot;feels_like\&quot;:18.14,\&quot;temp_min\&quot;:18.23,\&quot;temp_max\&quot;:18.23,\&quot;pressure\&quot;:1009,\&quot;humidity\&quot;:65,\&quot;sea_level\&quot;:1009,\&quot;grnd_level\&quot;:751},\&quot;visibility\&quot;:10000,\&quot;wind\&quot;:{\&quot;speed\&quot;:0.82,\&quot;deg\&quot;:205},\&quot;clouds\&quot;:{\&quot;all\&quot;:75},\&quot;dt\&quot;:1606330770,\&quot;sys\&quot;:{\&quot;country\&quot;:\&quot;CO\&quot;,\&quot;sunrise\&quot;:1606301230,\&quot;sunset\&quot;:1606344012},\&quot;timezone\&quot;:-18000,\&quot;id\&quot;:3688689,\&quot;name\&quot;:\&quot;Bogotá\&quot;,\&quot;cod\&quot;:200}&quot;</code></pre>
<pre class="r"><code># API Key protection

alphavantage_api_url &lt;- &quot;https://www.alphavantage.co/query&quot;
ticker               &lt;- &quot;WDI.DE&quot;

GET(alphavantage_api_url, query = list(&#39;function&#39; = &quot;GLOBAL_QUOTE&quot;,
                                       symbol     = ticker,
                                       apikey     = Sys.getenv(&quot;MyPersonalToken&quot;))
)</code></pre>
<pre><code>## Response [https://www.alphavantage.co/query?function=GLOBAL_QUOTE&amp;symbol=WDI.DE&amp;apikey=]
##   Date: 2020-11-25 19:07
##   Status: 200
##   Content-Type: application/json
##   Size: 189 B
## {
##     &quot;Error Message&quot;: &quot;the parameter apikey is invalid or missing. Please clai...</code></pre>
</div>
<div id="scraping-information" class="section level2">
<h2>Scraping information</h2>
<p>The selected competitor website was <a href="https://www.rosebikes.de/" class="uri">https://www.rosebikes.de/</a>. The code produced is</p>
<pre class="r"><code># SECTION 2.0

# 2.0 LIBRARIES

library(tidyverse) # Main Package - Loads dplyr, purrr, etc.
library(rvest)     # HTML Hacking &amp; Web Scraping
library(xopen)     # Quickly opening URLs
library(jsonlite)  # converts JSON files to R objects
library(glue)      # concatenate strings
library(stringi)   # character string/text processing
library(httr)      # include functions 
library(rstudioapi)# Securing credentials
# 2.1 Collection of products features

url_home &lt;- &quot;https://www.rosebikes.de/fahrräder/mtb&quot;

xopen(url_home)</code></pre>
<pre><code>## Running cmd /c start &quot;\&quot;\&quot;&quot; /b &quot;https://www.rosebikes.de/fahrräder/mtb&quot;</code></pre>
<pre class="r"><code>html_home &lt;- read_html(url_home)

mtb_bikes_family &lt;- html_home %&gt;%
  
  html_nodes(css = &quot;.catalog-category-bikes__title-text&quot;) %&gt;% html_text() %&gt;% 
  
  enframe(name = &quot;position&quot;,value = &quot;Family_class&quot;) %&gt;% mutate( family_class = str_glue(&quot;#MTB&quot;))
  
  
mtb_bikes_price &lt;- html_home  %&gt;% html_nodes(css = &quot;.catalog-category-bikes__price-title&quot;) %&gt;% html_text() %&gt;% 
  
  enframe(name = &quot;position&quot;,value = &quot;Price&quot;) 

mtb_bikes_tbl &lt;- mtb_bikes_family %&gt;% left_join(mtb_bikes_price, by = c(&quot;position&quot;=&quot;position&quot;))

# Printing the data

mtb_bikes_tbl %&gt;% print()</code></pre>
<pre><code>## # A tibble: 9 x 4
##   position Family_class            family_class Price              
##      &lt;int&gt; &lt;chr&gt;                   &lt;glue&gt;       &lt;chr&gt;              
## 1        1 &quot;\nGROUND CONTROL\n&quot;    #MTB         &quot;\nab 1.699,00 €\n&quot;
## 2        2 &quot;\nROOT MILLER\n&quot;       #MTB         &quot;\nab 1.999,00 €\n&quot;
## 3        3 &quot;\nPIKES PEAK\n&quot;        #MTB         &quot;\nab 3.099,00 €\n&quot;
## 4        4 &quot;\nTHE BRUCE\n&quot;         #MTB         &quot;\n&quot;               
## 5        5 &quot;\nCOUNT SOLO\n&quot;        #MTB         &quot;\n&quot;               
## 6        6 &quot;\nPSYCHO PATH\n&quot;       #MTB         &quot;\nab 1.849,00 €\n&quot;
## 7        7 &quot;\nTHRILL HILL\n&quot;       #MTB         &quot;\nab 2.599,00 €\n&quot;
## 8        8 &quot;\nTHRILL HILL TRAIL\n&quot; #MTB         &quot;\nab 2.899,00 €\n&quot;
## 9        9 &quot;\nSOUL FIRE\n&quot;         #MTB         &quot;\nab 2.149,00 €\n&quot;</code></pre>
<pre class="r"><code>alphavantage_api_url &lt;- &quot;https://www.alphavantage.co/query&quot;
ticker               &lt;- &quot;WDI.DE&quot;

GET(alphavantage_api_url, query = list(&#39;function&#39; = &quot;GLOBAL_QUOTE&quot;,
                                       symbol     = ticker,
                                       apikey     = Sys.getenv(&quot;MyPersonalToken&quot;))
)</code></pre>
<pre><code>## Response [https://www.alphavantage.co/query?function=GLOBAL_QUOTE&amp;symbol=WDI.DE&amp;apikey=]
##   Date: 2020-11-25 19:07
##   Status: 200
##   Content-Type: application/json
##   Size: 189 B
## {
##     &quot;Error Message&quot;: &quot;the parameter apikey is invalid or missing. Please clai...</code></pre>
</div>
</div>
<div id="challenge-3" class="section level1">
<h1>CHALLENGE 3</h1>
<div id="part-1" class="section level2">
<h2>Part 1</h2>
<p>The top ten companies with the most patents</p>
<pre class="r"><code># 1.0 libraries
library(vroom)
library(readxl)
library(&quot;writexl&quot;)
library(tidyr)
library(purrr)
library(&quot;stringr&quot;) 
library(dplyr)
library(data.table)
# Tidyverse
library(tidyverse)

# 2.0 import data

col_assignee &lt;- list(
  id = col_character(),
  type = col_character(),
  name_first = col_character(),
  name_last = col_character(),
  organization = col_character()
)

col_patent_assignee &lt;- list(
  patent_id = col_character(),
  assignee_id = col_character(),
  location_id = col_character()
  
)

library(vroom)
col_types &lt;- list(
  id = col_character(),
  type = col_character(),
  number = col_character(),
  country = col_character(),
  date = col_date(&quot;%Y-%m-%d&quot;),
  abstract = col_character(),
  title = col_character(),
  kind = col_character(),
  num_claims = col_double(),
  filename = col_character(),
  withdrawn = col_double()
)

uspc_tbl &lt;- list(
  uuid = col_character(),
  pat_id = col_character(),
  mainclass_id = col_character(),
  subclass_id = col_character(),
  sequence = col_character()
)

patent_tbl &lt;- vroom(
  file       = &quot;patent.tsv&quot;, 
  delim      = &quot;\t&quot;, 
  col_types  = list(id = col_skip(),type = col_skip(),abstract = col_skip(),withdrawn = col_skip()),
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
)

assignee_tbl &lt;- vroom(
  
  file = &quot;assignee.tsv&quot;,
  delim      = &quot;\t&quot;, 
  col_types  = list(name_first = col_skip(),name_last = col_skip()),
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
  
)

patent_assignee_tbl &lt;- vroom(
  
  file = &quot;patent_assignee.tsv&quot;,
  delim      = &quot;\t&quot;, 
  col_types  =  col_patent_assignee,
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
  
)

uspc_tbl &lt;- vroom(
  
  file = &quot;uspc.tsv&quot;,
  delim      = &quot;\t&quot;, 
  col_types  =  list(uuid = col_skip(), subclass_id = col_skip()),
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
  
)


class(uspc_tbl)

setDT(uspc_tbl)

class(patent_tbl)

setDT(patent_tbl)

class(assignee_tbl)

setDT(assignee_tbl)

class(patent_assignee_tbl)

setDT(patent_assignee_tbl)

## Challenge 3.1

### 3.0 Data Wranggling

patent_assignee_tbl &lt;- patent_assignee_tbl %&gt;% select(patent_id, assignee_id, location_id) %&gt;% rename(pat_id = patent_id,
                                                                                                      id = assignee_id,
                                                                                                      Loc_id = location_id) 

complete_patent_tbl &lt;- merge(x = patent_assignee_tbl, y = assignee_tbl, by = &quot;id&quot;,all.x = TRUE, all.y = TRUE)

### filtering Critirea

## Categories

### 2 US Company or Corporation
### 4 US individual
### 6 US Federal government
### 8 US County Government
### 9 US State Government

filtered_data &lt;- complete_patent_tbl %&gt;% select(type,organization) %&gt;% filter((type %% 2 == 0)|(type == 9))

num_patents_by_co &lt;- filtered_data %&gt;% group_by(organization) %&gt;% count() %&gt;% arrange(desc(n)) 

num_patents_by_co %&gt;% head(n=10)</code></pre>
<pre class="r"><code>library(readxl)

num_patents_by_comp &lt;- read_csv(&quot;num_patents_by_com.csv&quot;)

num_patents_by_comp </code></pre>
<pre><code>## # A tibble: 10 x 2
##    organization                                     n
##    &lt;chr&gt;                                        &lt;dbl&gt;
##  1 International Business Machines Corporation 139092
##  2 &lt;NA&gt;                                         72951
##  3 General Electric Company                     47122
##  4 Intel Corporation                            42157
##  5 Hewlett-Packard Development Company, L.P.    35573
##  6 Microsoft Corporation                        30086
##  7 Micron Technology, Inc.                      28001
##  8 QUALCOMM Incorporated                        24703
##  9 Texas Instruments Incorporated               24182
## 10 Xerox Corporation                            23174</code></pre>
<pre class="r"><code>## Challenge 3.2
patent_assignee_tbl &lt;- complete_patent_tbl %&gt;% select(id,pat_id,Loc_id,type,organization)%&gt;% rename(id = id,
                                                                                                    number = pat_id,
                                                                                                    loc_id = Loc_id,
                                                                                                    type = type,
                                                                                                    org = organization)

merged_patent_tbl &lt;- merge(x = patent_tbl, y = patent_assignee_tbl, by = &quot;number&quot;,all.x = TRUE, all.y = TRUE)


filtered_patent_tbl &lt;- merged_patent_tbl %&gt;% select(number,country,date,type,org) %&gt;% filter((type %% 2 == 0)|(type == 9))

filtered_patent_tbl &lt;- filtered_patent_tbl %&gt;% select(number,country,date,type,org)  %&gt;% filter(!is.na(date)) 

ru_patent_tbl &lt;- filtered_patent_tbl %&gt;% select(number,country,date,org) %&gt;% separate(col = date,
                                                                   into = c(&quot;year&quot;,&quot;month&quot;,&quot;day&quot;),
                                                                   sep = &#39;-&#39;,remove = FALSE)
ru_patent_tbl &lt;- ru_patent_tbl %&gt;% select(-date)

ru_patent_tbl &lt;- ru_patent_tbl %&gt;% select(number,country,year,org) %&gt;% filter(year == 2019)

patents_by_company_in_2019 &lt;- ru_patent_tbl %&gt;% group_by(org,year) %&gt;% count() %&gt;% arrange(desc(n)) 

patents_by_company_in_2019 %&gt;% head(n=10)</code></pre>
<pre class="r"><code>patents_by_company_2019 &lt;- read_csv(&quot;patents_by_company_2019.csv&quot;)

patents_by_company_2019 </code></pre>
<pre><code>## # A tibble: 10 x 3
##    org                                          year     n
##    &lt;chr&gt;                                       &lt;dbl&gt; &lt;dbl&gt;
##  1 International Business Machines Corporation  2019  9265
##  2 Intel Corporation                            2019  3526
##  3 Microsoft Technology Licensing, LLC          2019  3106
##  4 Apple Inc.                                   2019  2817
##  5 Ford Global Technologies, LLC                2019  2624
##  6 Amazon Technologies, Inc.                    2019  2533
##  7 QUALCOMM Incorporated                        2019  2359
##  8 Google Inc.                                  2019  2290
##  9 General Electric Company                     2019  1860
## 10 Hewlett-Packard Development Company, L.P.    2019  1589</code></pre>
<pre class="r"><code>complete_upatent_tbl &lt;- complete_patent_tbl %&gt;% select(id,pat_id,Loc_id,type,organization) %&gt;% filter(!is.na(pat_id)) %&gt;% arrange(desc(pat_id))

uspc_tbl &lt;- uspc_tbl %&gt;% select(patent_id,mainclass_id,sequence) %&gt;% rename(pat_id = patent_id,
                                                                            mclass = mainclass_id,
                                                                            sqc = sequence)

complete_upatent_tbl &lt;- merge(x = complete_upatent_tbl, y = uspc_tbl, by = &quot;pat_id&quot;,all.x = TRUE, all.y = TRUE) %&gt;% filter(!is.na(mclass))

complete_upatent_tbl &lt;- complete_upatent_tbl %&gt;% filter(!is.na(organization))

filtered_patent_tbl &lt;- complete_upatent_tbl %&gt;% group_by(pat_id,organization,mclass) %&gt;% count() %&gt;% arrange(desc(n))

top_10_companies &lt;- filtered_patent_tbl %&gt;% group_by(pat_id,organization) %&gt;% count() %&gt;% arrange(desc(n))

top_10_org &lt;- top_10_companies %&gt;%  group_by(organization) %&gt;% count() %&gt;% arrange(desc(n)) %&gt;% head(n=10)

top_uspto &lt;- merge(x = top_10_org, y = filtered_patent_tbl, by = &quot;organization&quot;,all.x = TRUE, all.y = TRUE)

top_5_uspto &lt;- top_uspto %&gt;% select(organization, n.x, pat_id, mclass) %&gt;% filter(!is.na(n.x)) %&gt;% arrange(desc(mclass))

top_5_uspto &lt;- top_5_uspto %&gt;% group_by(mclass) %&gt;% count() %&gt;% arrange(desc(n))

top_5_uspto %&gt;% head(n = 5) %&gt;% glimpse() 

## filtering Critirea

## Step 1:
###       a) Trew away the na.rows of organization and mclass at the frist two command lines
###       b) Counted the number of times a patent was assigned to an organization, considering the mainclass
###       c) Counted the number of times an organization was awarded a patent
###       d) Extracted the top ten companies with most patents in top_10_org
###       e) Filtered (using merge) the top ten companies in the filtered_patent_tbl to get the the mainclass of the top tehn companies
###       f) Finally, count the number of times mainclasses appears from the top ten companies
###       h) Got the top five USPTO tech mainclasses</code></pre>
<pre class="r"><code>top_5_uspto &lt;- read_csv(&quot;top_5_uspto.csv&quot;)

top_5_uspto </code></pre>
<pre><code>## # A tibble: 5 x 2
##   mclass     n
##    &lt;dbl&gt; &lt;dbl&gt;
## 1    257 29872
## 2    438 19543
## 3    358 17228
## 4    348 16300
## 5    709 16058</code></pre>
</div>
<div id="challenge-4" class="section level2">
<h2>Challenge 4</h2>
<div id="covid-confirmed-cases" class="section level3">
<h3>COVID confirmed cases</h3>
<pre class="r"><code># Challenge 1

# Challenge 1

# 1.0 Libraries
library(maps)
library(dplyr)
library(tidyverse)
library(lubridate)
library(readxl)
library(ggplot2)

# 2.0 Data acquisition

covid_data_tbl &lt;- read_csv(&quot;https://opendata.ecdc.europa.eu/covid19/casedistribution/csv&quot;)

# 3.0 Data manipulation

cases_in_2020 &lt;- covid_data_tbl %&gt;% select(dateRep,year,month,cases,deaths,countriesAndTerritories,continentExp,popData2019) %&gt;% 
  mutate(across(countriesAndTerritories, str_replace_all, &quot;_&quot;, &quot; &quot;)) %&gt;%
  mutate(countriesAndTerritories = case_when(
    
    countriesAndTerritories == &quot;United Kingdom&quot; ~ &quot;UK&quot;,
    countriesAndTerritories == &quot;United States of America&quot; ~ &quot;USA&quot;,
    countriesAndTerritories == &quot;Czechia&quot; ~ &quot;Czech Republic&quot;,
    TRUE ~ countriesAndTerritories
    
  ))

cases_by_dmonth_2020 &lt;- cases_in_2020 %&gt;% select(dateRep,month,year,cases,countriesAndTerritories) %&gt;%
  mutate(dateRep = dmy(dateRep)) %&gt;% filter(year %in% &quot;2020&quot; &amp; countriesAndTerritories %in% c(&quot;Germany&quot;,&quot;France&quot;,&quot;UK&quot;,&quot;Spain&quot;,&quot;USA&quot;)) %&gt;%
  arrange((dateRep))

cases_by_month_2020 &lt;- cases_by_dmonth_2020 %&gt;% group_by(countriesAndTerritories) %&gt;%
  mutate(cumulative_cases = cumsum(cases)) %&gt;% ungroup()
  
cases_by_month_2020 %&gt;% ggplot(aes(x = dateRep,y = cumulative_cases,size = total_cases)) + 
  geom_line(aes(color = countriesAndTerritories), size = 1.0) +
  scale_x_date(breaks = &quot;1 month&quot;, date_labels = &quot;%B&quot;) + 
  scale_y_continuous(labels = scales::number_format(scale = 1/1e6, big.mark = &quot;.&quot;, decimal.mark = &quot;,&quot;, suffix = &quot;M&quot;))+
  theme_test()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(
    title = &quot;COVID-19 confirmed cases worldwide&quot;,
    subtitle = &quot;Last update: 30-11-2020&quot;,
    caption = &quot;Data taken from: https://opendata.ecdc.europa.eu/covid19/casedistribution/csv&quot;,
    x = &quot;Months&quot;,
    y = &quot;Cumulative cases&quot;,
    color = &quot;Countries&quot;
    
  ) </code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>map_cases_2020 &lt;- cases_in_2020 %&gt;% select(dateRep,month,year,cases,countriesAndTerritories,everything()) %&gt;%
  mutate(dateRep = dmy(dateRep)) %&gt;% filter(year %in% &quot;2020&quot;) %&gt;% arrange((dateRep))

map_cases_2020 &lt;- map_cases_2020 %&gt;% select(everything()) %&gt;% rename(
  
  date = dateRep,
  month = month,
  year = year,
  cases = cases,
  region = countriesAndTerritories,
  continents = continentExp,
  population = popData2019
) 

map_cases_2020 &lt;- map_cases_2020 %&gt;% select(everything()) %&gt;% group_by(year,region,population) %&gt;% summarize(mortality = sum(deaths)) %&gt;% ungroup()

world &lt;- map_data(&quot;world&quot;)

covid_map_data_2020 &lt;- merge(map_cases_2020,world, by = &quot;region&quot;)

covid_map_data_2020 &lt;- covid_map_data_2020 %&gt;% mutate(rate_mortality = mortality/population)

covid_map_data_2020 %&gt;% ggplot(aes(long, lat, group = group)) + 
  geom_map(aes(map_id = region,fill = rate_mortality),map = world) +
  scale_fill_viridis_c(option = &quot;C&quot;) +
  labs(
    title = &quot;Confirmed COVID-19 deaths relative to the size of the population&quot;,
    subtitle = &quot;Last update: 30-11-2020&quot;,
    caption = &quot;Data taken from: https://opendata.ecdc.europa.eu/covid19/casedistribution/csv&quot;,
    x = &quot;Longitude&quot;,
    y = &quot;Latitude&quot;,
    color = &quot;Countries&quot;
) + theme_test()</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<p>When you knit this R Markdown document, you will see that the histogram is printed to the page, along with the R code. This document can be set up to hide the R code in the webpage, just delete the comment (hashtag) from the cold folding option in the yaml header up top. For purposes of letting yourself see the code, and me see the code, best to keep it the way that it is. You’ll learn that all of these things and more can be customized in each R code block.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
